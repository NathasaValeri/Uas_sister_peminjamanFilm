<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS Sister - Peminjaman Film</title>
    <style>
        body { font-family: sans-serif; margin: 40px; line-height: 1.6; background-color: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #218838; }
        .movie-card { border: 1px solid #ddd; padding: 10px; margin-top: 10px; border-radius: 4px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="authSection">
    <h2 id="formTitle">Login Pengguna</h2>
    
    <input type="email" id="email" placeholder="Email (contoh: tasya@mail.com)">
    <input type="password" id="password" placeholder="Password">
    
    <button onclick="handleAuth()" id="authBtn">Login</button>
    <p style="text-align: center;">
        <a href="#" onclick="toggleAuth()" id="toggleText">Belum punya akun? Daftar di sini</a>
    </p>
</div>

<div class="container hidden" id="movieSection">
    <h2>Daftar Film Tersedia</h2>
    <div id="movieList">Sedang memuat film...</div>
    <br>
    <button onclick="logout()" style="background-color: #dc3545;">Logout</button>
</div>

<script>
    // === 1. GANTI DENGAN LINK BACKEND VERCEL ANDA ===
    const API_URL = "https://uas-sister-peminjaman-film-c8b6.vercel.app";

    let isLoginMode = true;

    function toggleAuth() {
        isLoginMode = !isLoginMode;
        document.getElementById('formTitle').innerText = isLoginMode ? "Login Pengguna" : "Daftar Akun Baru";
        document.getElementById('authBtn').innerText = isLoginMode ? "Login" : "Daftar";
        document.getElementById('toggleText').innerText = isLoginMode ? "Belum punya akun? Daftar di sini" : "Sudah punya akun? Login";
    }

    async function handleAuth() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const endpoint = isLoginMode ? '/auth/login' : '/auth/register';

        if (!email || !password) return alert("Isi email dan password!");

        try {
            const response = await fetch(`${API_URL}${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (response.ok) {
                alert(data.message);
                if (isLoginMode) {
                    showMovies(); // Jika login sukses, tampilkan daftar film
                } else {
                    toggleAuth(); // Jika register sukses, pindah ke mode login
                }
            } else {
                alert("Error: " + data.message);
            }
        } catch (error) {
            console.error(error);
            alert("Gagal terhubung ke API. Pastikan API_URL benar dan Backend sudah jalan.");
        }
    }

    async function showMovies() {
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('movieSection').classList.remove('hidden');

        try {
            const response = await fetch(`${API_URL}/movie/movies`);
            const movies = await response.json();
            const listDiv = document.getElementById('movieList');
            listDiv.innerHTML = "";

            if (movies.length === 0) {
                listDiv.innerHTML = "Tidak ada film tersedia di database.";
            } else {
                movies.forEach(m => {
                    listDiv.innerHTML += `
                        <div class="movie-card">
                            <strong>${m.title}</strong><br>
                            Genre: ${m.genre}
                        </div>`;
                });
            }
        } catch (error) {
            document.getElementById('movieList').innerHTML = "Gagal mengambil data film.";
        }
    }

    function logout() {
        location.reload(); // Segarkan halaman untuk kembali ke menu login
    }
</script>

</body>
</html>
